Error in working memory cleanup: ChromaDB collection not initialized
ChromaDBAdapter auto-initializing collection on demand (explicit .initialize() was not called).
C:\roampal-core\roampal\backend\modules\memory\chromadb_adapter.py:623: RuntimeWarning: coroutine 'ChromaDBAdapter.cleanup' was never awaited
  pass  # Ignore errors in destructor
RuntimeWarning: Enable tracemalloc to get the object allocation traceback

================================================================================
SEMANTIC CONFUSION STRESS TEST - 15:1 Noise Ratio
================================================================================

Challenge: Find the REAL Sarah among 47 similar-looking impostors

[SETUP] Storing 3 ground truth facts about Sarah Chen (HIGH QUALITY)...
  [OK] Truth 1/3 (quality=0.93): Sarah Chen is 34 years old and works as a software engineer ...
  [OK] Truth 2/3 (quality=0.93): Sarah Chen's email is sarah.chen@techcorp.com and she lives ...
  [OK] Truth 3/3 (quality=0.93): Sarah Chen graduated from Stanford with a CS degree and has ...

[SETUP] Storing 47 confusing noise facts (LOW QUALITY)...
  [OK] 10/47 noise facts stored (quality=0.08)...
  [OK] 20/47 noise facts stored (quality=0.08)...
  [OK] 30/47 noise facts stored (quality=0.08)...
  [OK] 40/47 noise facts stored (quality=0.08)...

[VERIFY] Total stored: 3 truth + 47 noise = 50 docs
[VERIFY] Noise ratio: 15.7:1
[VERIFY] Quality gap: Truth=0.93 vs Noise=0.08 (12x higher)
[DEBUG] Truth IDs: ['memory_bank_74757738', 'memory_bank_2ea2f513', 'memory_bank_1900fe2f']
[DEBUG] First 5 Noise IDs: ['memory_bank_fb5368da', 'memory_bank_42bb26a1', 'memory_bank_acee16c0', 'memory_bank_4ef382f6', 'memory_bank_28df09fa']

--------------------------------------------------------------------------------
RUNNING TEST QUERIES
--------------------------------------------------------------------------------

[EASY] Query: "Sarah Chen TechCorp engineer"
         Direct query - should be easy
         Results: 1/3 truth in top 5 (4 noise)
           1. [TRUTH] q=0.93 rank=1.173 | Sarah Chen is 34 years old and works as a software engineer at TechCor...
           2. [noise] q=0.07 rank=0.514 | Sarah Chen, 34, engineer at TechCorp Inc (the consulting firm)....
           3. [noise] q=0.07 rank=0.335 | Sarah Chen is a product manager at TechCorp....
           4. [noise] q=0.07 rank=0.330 | Sarah Chen works in HR at a tech company....
           5. [noise] q=0.07 rank=0.308 | Sarah Chen works at TechCorp as a product manager....

[MEDIUM] Query: "What does Sarah Chen do for work?"
         Natural language - medium difficulty
         Results: 0/3 truth in top 5 (5 noise)
           1. [noise] q=0.07 rank=0.194 | Sarah Chen is 28 years old and just started her career....
           2. [noise] q=0.07 rank=0.192 | Is Sarah Chen the one who works at TechCorp?...
           3. [noise] q=0.07 rank=0.192 | Looking up information about Sarah Chen....
           4. [noise] q=0.07 rank=0.184 | Confirming Sarah Chen's employment information....
           5. [noise] q=0.07 rank=0.173 | Sarah Chen works in HR at a tech company....

[HARD] Query: "Sarah age job company"
         Sparse keywords - harder
         Results: 1/3 truth in top 5 (4 noise)
           1. [TRUTH] q=0.93 rank=0.672 | Sarah Chen is 34 years old and works as a software engineer at TechCor...
           2. [noise] q=0.07 rank=0.170 | Sarah C. is 34, works in tech somewhere in California....
           3. [noise] q=0.07 rank=0.145 | Sarah Chen at TechCorp is 28 years old....
           4. [noise] q=0.07 rank=0.141 | Someone named Sarah works in tech, maybe engineering....
           5. [noise] q=0.07 rank=0.134 | Sarah Chen works in HR at a tech company....

[BRUTAL] Query: "the user Sarah"
         Vague reference - very hard
         Results: 0/3 truth in top 5 (5 noise)
           1. [noise] q=0.07 rank=0.171 | Sarah is a common name in tech companies....
           2. [noise] q=0.07 rank=0.143 | User asked about Sarah Chen's background....
           3. [noise] q=0.07 rank=0.139 | The user mentioned Sarah Chen multiple times in conversation....
           4. [noise] q=0.07 rank=0.137 | Looking up information about Sarah Chen....
           5. [noise] q=0.07 rank=0.135 | Someone named Sarah works in tech, maybe engineering....

[NIGHTMARE] Query: "software engineer 34 years old"
         No name! Must infer from quality
         Results: 1/3 truth in top 5 (4 noise)
           1. [TRUTH] q=0.93 rank=0.873 | Sarah Chen is 34 years old and works as a software engineer at TechCor...
           2. [noise] q=0.07 rank=0.312 | A software engineer in their 30s works at TechCorp....
           3. [noise] q=0.07 rank=0.177 | Michael Chen is 34 and works at TechCorp as an engineer....
           4. [noise] q=0.07 rank=0.174 | Sera Chen is 33 years old, software developer at a startup....
           5. [noise] q=0.07 rank=0.162 | Sarah Park, software engineer, 34, works in tech....

================================================================================
FINAL RESULTS
================================================================================
Total truth docs found: 3/15 (20.0%)
Truth ranked #1: 3/5 queries (60.0%)
Noise ratio survived: 16:1

[MECHANISM] 3-stage quality enforcement:
  1. Distance boost: adjusted_distance = L2_distance * (1.0 - quality * 0.8)
  2. L2->Similarity: similarity = 1 / (1 + distance)
  3. CE multiplier: final_score = blended_score * (1 + quality)

================================================================================
PASS - Quality ranking works: truth #1 in 3/5 queries
       Survived 16:1 noise ratio
================================================================================
